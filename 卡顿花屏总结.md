## 卡顿
慢网效应下，指定时间内下载的数据不足导致播放卡顿
#### CDN做法
1. 音频对码率影响不大，而且人对非连续声音非常敏感，保留音频流
2. 视频丢帧，胡乱丢帧会导致播放花屏，常见做法：
a. 整个gop的丢，主观体验会有卡顿跳帧，但避免了花屏
b. 丢掉每个gop尾部的帧，优化做法是重新插入sps和pps(在sps数据包中，里面包含有非常重要的帧率信息)，配合调整帧率，让每一帧的播放时间延长，主观体验和程序卡顿都有很好效果
```
1、终端告知CDN OC终端的接收能力，比如每秒只能接收18帧（实际流畅播放帧率为30fps）
2、CDN OC控制发送的数据，按照丢弃每GOP内后面40%的音视频帧来丢数据，这样用户(观众)的肉眼卡顿感不强
3、为了保证足够时长播放，CDN OC配合重新下发SPS信息，重新定制帧率，这样也将消除“网慢效应”造成的卡顿
(4、最终数据写进播放器时，最好将时间戳dts重新调整均匀，防止部分播放器比如flv.js因时间戳不连续播放卡顿)
```

## 花屏
1. I帧或P帧缺失（a.网络丢包; b.接收端或发送端的随机丢帧策略），后续帧的解码依赖丢失帧，导致花屏（I帧丢失更严重：绿屏、黑屏）
2. I帧或P帧内容损坏，原理同1
3. sps和pps信息错误
4. 播放器问题，比如播放器的h264 parser与转码端格式不兼容，数据截断


## 音视频同步播放原理
音频帧和视频帧都有自己的pts（没有的情况下需要根据采样率进行计算），播放时按照pts进行同步，由于人对非连续声音非常敏感，所以普遍策略是以音频播放为主逻辑，通过调整视频帧播放进行同步：

1. 如果音频比视频快，加快视频帧播放，比如丢帧播放
2. 如果音频比视频慢，放慢视频帧播放，延长当前帧的显示时间

```
1. 无法察觉：音频和视频的时间戳差值在：-100ms ~ +25ms 之间
2. 能够察觉：音频滞后了 100ms 以上，或者超前了 25ms 以上
3. 无法接受：音频滞后了 185ms 以上，或者超前了 90ms 以上
```
